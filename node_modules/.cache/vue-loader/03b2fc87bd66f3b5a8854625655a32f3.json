{"remainingRequest":"/home/bonifacio/code/service_bundle_frontend/node_modules/@vue/cli-service/lib/config/vue-loader-v15-resolve-compat/vue-loader.js??vue-loader-options!/home/bonifacio/code/service_bundle_frontend/src/components/LoginForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/bonifacio/code/service_bundle_frontend/src/components/LoginForm.vue","mtime":1696426824528},{"path":"/home/bonifacio/code/service_bundle_frontend/node_modules/babel-loader/lib/index.js","mtime":1692833949708},{"path":"/home/bonifacio/code/service_bundle_frontend/node_modules/cache-loader/dist/cjs.js","mtime":1692838039149},{"path":"/home/bonifacio/code/service_bundle_frontend/node_modules/@vue/cli-service/lib/config/vue-loader-v15-resolve-compat/vue-loader.js","mtime":1692833961693}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHVzZVZ1ZWxpZGF0ZSB9IGZyb20gJ0B2dWVsaWRhdGUvY29yZScKaW1wb3J0IHsgcmVxdWlyZWQsIGVtYWlsLCBoZWxwZXJzIH0gZnJvbSAnQHZ1ZWxpZGF0ZS92YWxpZGF0b3JzJwppbXBvcnQgU2lnbkluVXNlciBmcm9tICdAL2dyYXBocWwvTG9naW4uZ3FsJzsKaW1wb3J0IHsgb25Mb2dpbiwgY3JlYXRlUHJvdmlkZXIgfSBmcm9tICdAL3Z1ZS1hcG9sbG8uanMnOwppbXBvcnQgeyBtYXBTdGF0ZSwgbWFwTXV0YXRpb25zIH0gZnJvbSAndnVleCc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogJ0xvZ2luRm9ybScsCiAgICBzZXR1cCAoKSB7IHJldHVybiB7IHYkOiB1c2VWdWVsaWRhdGUoKSB9IH0sCiAgICBkYXRhICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBlbWFpbDogbnVsbCwKICAgICAgICAgICAgcGFzc3dvcmQ6IG51bGwKICAgICAgICB9CiAgICB9LAogICAgdmFsaWRhdGlvbnMgKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVtYWlsOiB7IHJlcXVpcmVkOiBoZWxwZXJzLndpdGhNZXNzYWdlKCdFbWFpbCBpcyByZXF1aXJlZC4nLCByZXF1aXJlZCksIGVtYWlsIH0sCiAgICAgICAgICAgIHBhc3N3b3JkOiB7IHJlcXVpcmVkOiBoZWxwZXJzLndpdGhNZXNzYWdlKCdQYXNzd29yZCBpcyByZXF1aXJlZC4nLCByZXF1aXJlZCkgfQogICAgICAgIH0KICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIC4uLm1hcFN0YXRlKFsnaXNBdXRoZW50aWNhdGVkJywgJ3VzZXJSb2xlJ10pLAogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBpc19sb2dnZWRfaW4oKSB7CiAgICAgICAgaWYgKHRoaXMuZ2V0X3JvbGUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvJyk7CiAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgc3VibWl0Rm9ybSgpIHsKICAgICAgICAgICAgdGhpcy52JC4kdG91Y2goKTsKICAgICAgICAgICAgaWYgKCF0aGlzLnYkLiRlcnJvcikgewogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRhcG9sbG8ubXV0YXRlKHsKICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbjogU2lnbkluVXNlciwKICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLmVtYWlsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgdG8gaG9tZXBhZ2UgZm9yIHZhbGlkIGNyZWRlbnRpYWxzCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5sb2dpbiA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgcmVzcG9uc2UgdG9rZW4gZnJvbSB0aGUgYmFja2VuZAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgcmVzcG9uc2UuZGF0YS5sb2dpbi50b2tlbgogICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB0aGUgQXV0aG9yaXphdGlvbiBoZWFkZXIgd2l0aCB0aGUgdG9rZW4gcHJvdmlkZWQgYnkgdGhlIGJhY2tlbmQKICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJzID0geyBBdXRob3JpemF0aW9uOiB0b2tlbiB9OwogICAgICAgICAgICAgICAgICAgIC8vIHRlbGxzIHZ1ZSB0aGF0IGF1dGhlbnRpY2F0aW9uIGlzIHRydWUgYW5kIGNoYW5jZSBzb21lIGNvbXBvbmVudHMKICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlID0gYXdhaXQgcmVzcG9uc2UuZGF0YS5sb2dpbi5yb2xlOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgcm9sZSBnZXQgZnJvbSB0aGUgc2VydmljZSB2aWUgcmVzcG9uc2UgZGF0YSBpcyAnLCByb2xlKQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlclJvbGUocm9sZSkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbmV3IHJvbGUgbm93Jyx0aGlzLnVzZXJSb2xlKTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnRvZ2dsZUF1dGhlbnRpY2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgdGhlIHRva2VuIGluIGxvY2FsU3RvcmF0ZSAKICAgICAgICAgICAgICAgICAgICAvLyB1c2luZyB0aGUgZGVmYXVsdCBvbkxvZ2luIG1ldGhvZCBwcm92aWRlZCBieSB2dWUtYXBvbGxvLmpzCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgb25Mb2dpbihjcmVhdGVQcm92aWRlcih7fSwgaGVhZGVycyksIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byBIb21lcGFnZQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldF9yb2xlKCk9PSJhZG1pbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL21lcmNoYW50JzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC4uLm1hcE11dGF0aW9ucyhbJ3NldEF1dGhlbnRpY2F0ZWQnXSksCiAgICAgICAgdG9nZ2xlQXV0aGVudGljYXRpb24oKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QXV0aGVudGljYXRlZCghdGhpcy5pc0F1dGhlbnRpY2F0ZWQpOwogICAgICAgIH0sCiAgICAgICAgZ2V0X3JvbGUoKXsKICAgICAgICAgICAgY29uc3QgdXNlclJvbGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlclJvbGUnKTsKICAgICAgICAgICAgcmV0dXJuIHVzZXJSb2xlOwogICAgICAgIH0sCgogICAgICAgIHVwZGF0ZVVzZXJSb2xlKHJvbGUpIHsKICAgICAgICAgICAgLy8gQ2FsbCB0aGUgbXV0YXRpb24gJ3NldFVzZXJSb2xlJyB3aXRoIGEgcGF5bG9hZCAodXNlclJvbGUpCiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnc2V0VXNlclJvbGUnLCByb2xlKTsgLy8gUmVwbGFjZSAnYWRtaW4nIHdpdGggeW91ciBhY3R1YWwgdXNlciByb2xlIGRhdGEKICAgICAgICB9LAogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgdGhpcy5pc19sb2dnZWRfaW4oKTsKICAgIH0KCn0K"},{"version":3,"sources":["LoginForm.vue"],"names":[],"mappings":";AAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"LoginForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"row d-flex justify-content-center align-items-center h-100\">\n        <div class=\"col-md-9 col-lg-6 col-xl-5\">\n            <img src=\"https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-login-form/draw2.webp\" class=\"img-fluid\" alt=\"Login to MovieMagic\">\n        </div>\n        <div class=\"col-md-8 col-lg-6 col-xl-4 offset-xl-1 signin-form\">\n            <div class=\"d-flex flex-row align-items-center justify-content-center justify-content-lg-start\">\n                <p class=\"login_text lead fw-normal mb-0 me-3\"></p>\n            </div>\n            <form @submit.prevent=\"submitForm\">\n                <!-- Email input -->\n                <div class=\"input-field-signin\">\n                    <div :class=\"{ error: v$.email.$errors.length }\">\n                        <label class=\"form-label\">Email\n                            <input v-model=\"email\" class=\"form-control form-control-l\" :class=\"{ error: v$.email.$errors.length }\">\n                            <div class=\"input-errors\" v-for=\"error of v$.email.$errors\" :key=\"error.$uid\">\n                                <div class=\"error-msg\">{{ error.$message }}</div>\n                            </div>\n                        </label>\n                    </div>\n                </div>\n                <!-- Password input -->\n                <div class=\"input-field-signin\">\n                    <div :class=\"{ error: v$.password.$errors.length }\">\n                        <label class=\"form-label\">Password\n                            <input v-model=\"password\" class=\"form-control form-control-l\" :class=\"{ error: v$.password.$errors.length }\" type=\"password\">\n                            <div class=\"input-errors\" v-for=\"error of v$.password.$errors\" :key=\"error.$uid\">\n                                <div class=\"error-msg\">{{ error.$message }}</div>\n                            </div> \n                        </label>                       \n                    </div>\n                </div>\n                <div class=\"d-flex justify-content-between align-items-center\">\n                    <!-- Checkbox -->\n                    <!-- <div class=\"form-check mb-0\">\n                        <input class=\"form-check-input me-2\" type=\"checkbox\" value=\"\" id=\"form2Example3\" />\n                        <label class=\"form-check-label\" for=\"form2Example3\"> Remember me </label>\n                    </div>\n                    <a href=\"#!\" class=\"text-body\">Forgot password?</a> -->\n                </div>\n                <div class=\"text-right text-lg-start mt-4 pt-2\">\n                    <button type=\"submit\" class=\"btn btn-primary btn-lg input-field-signin\">Log in</button>\n                    <p class=\"input-field-signin\">Don't have an account? <router-link to=\"/signup\">Signup</router-link></p>\n                    <p class=\"input-field-signin\"><a href=\"/signup_entrepreneur\">Are you an entrepreneur?</a></p>\n                </div>\n            </form>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { useVuelidate } from '@vuelidate/core'\nimport { required, email, helpers } from '@vuelidate/validators'\nimport SignInUser from '@/graphql/Login.gql';\nimport { onLogin, createProvider } from '@/vue-apollo.js';\nimport { mapState, mapMutations } from 'vuex';\nimport store from '@/store';\nexport default {\n    name: 'LoginForm',\n    setup () { return { v$: useVuelidate() } },\n    data () {\n        return {\n            email: null,\n            password: null\n        }\n    },\n    validations () {\n        return {\n            email: { required: helpers.withMessage('Email is required.', required), email },\n            password: { required: helpers.withMessage('Password is required.', required) }\n        }\n    },\n    computed: {\n        ...mapState(['isAuthenticated', 'userRole']),\n    },\n    methods: {\n        is_logged_in() {\n        if (this.get_role() == null) {\n            this.$router.push('/');\n        }\n        },\n        async submitForm() {\n            this.v$.$touch();\n            if (!this.v$.$error) {\n                const response = await this.$apollo.mutate({\n                    mutation: SignInUser,\n                    variables: {\n                        credentials: {\n                            email: this.email,\n                            password: this.password\n                        }\n                    },\n                });\n                // console.log(response)\n                // Redirect to homepage for valid credentials\n                if (response.data.login === null) {\n                    alert('Invalid credentials');\n                } else {\n                    // get the response token from the backend\n                    const token = await response.data.login.token\n                    // assign the Authorization header with the token provided by the backend\n                    const headers = { Authorization: token };\n                    // tells vue that authentication is true and chance some components\n                    const role = await response.data.login.role;\n                    console.log('The role get from the service vie response data is ', role)\n                    await this.updateUserRole(role)\n                    console.log('new role now',this.userRole);\n                    await this.toggleAuthentication();\n                    // store the token in localStorate \n                    // using the default onLogin method provided by vue-apollo.js\n                    await onLogin(createProvider({}, headers), token);\n                    // redirect to Homepage\n                    if (this.get_role()==\"admin\") {\n                        window.location.href = '/merchant';\n                    } else {\n                        window.location.href = '/';\n                    }\n                }\n            }\n        },\n        ...mapMutations(['setAuthenticated']),\n        toggleAuthentication() {\n            this.setAuthenticated(!this.isAuthenticated);\n        },\n        get_role(){\n            const userRole = localStorage.getItem('userRole');\n            return userRole;\n        },\n\n        updateUserRole(role) {\n            // Call the mutation 'setUserRole' with a payload (userRole)\n            store.commit('setUserRole', role); // Replace 'admin' with your actual user role data\n        },\n    },\n    mounted() {\n        this.is_logged_in();\n    }\n\n}\n</script>\n\n<style>\n.error, .error:focus {\n    border-color: red;\n    color: red;\n}\n.input-errors {\n    color: red;\n}\n.form-label {\n    position: relative;\n}\n.error-msg {\n    position: absolute;\n    font-size: 10px;\n    bottom: -13px;\n    left: 0px;\n}\n</style>"]}]}